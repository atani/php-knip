# ADR-0001: Symfonyコンポーネントの採用

## ステータス

採用済み (Accepted)

## コンテキスト

PHP-KnipのCLIインターフェースとファイル操作機能を実装するにあたり、以下の要件を満たすライブラリの選定が必要だった：

- PHP 5.6〜8.3の幅広いバージョンで動作すること
- CLIオプション/引数の解析、ヘルプ生成、カラー出力などの標準的なCLI機能
- 効率的なファイル検索とglobパターンマッチング
- 長期的なメンテナンスと安定性

## 決定

以下のSymfonyコンポーネントを採用する：

- **symfony/console** (^2.8|^3.4|^4.0|^5.0|^6.0|^7.0)
- **symfony/finder** (^2.8|^3.4|^4.0|^5.0|^6.0|^7.0)

## 理由

### symfony/console

1. **PHP 5.6対応**: v2.8からPHP 5.6をサポート
2. **業界標準**: PHPUnit, Composer, Laravel Artisan等で広く使用
3. **豊富な機能**:
   - コマンド定義とルーティング
   - オプション/引数の宣言的定義
   - 自動ヘルプ生成
   - カラー出力とプログレスバー
   - 入出力の抽象化（テスト容易性）
4. **学習コスト低**: 多くのPHP開発者が習熟済み

### symfony/finder

1. **効率的なファイル走査**: イテレータベースで大規模プロジェクトでもメモリ効率が良い
2. **柔軟なフィルタリング**:
   - globパターン
   - 正規表現
   - ファイルサイズ/日付によるフィルタ
   - .gitignore連携
3. **クロスプラットフォーム**: Windows/macOS/Linuxで一貫した動作

### 検討した代替案

| 選択肢 | 評価 |
|--------|------|
| 素のPHP (getopt) | CLIオプション処理が煩雑、ヘルプ生成なし |
| league/climate | PHP 5.6対応が限定的 |
| hoa/console | メンテナンス状況が不明確 |
| 独自実装 | 開発コスト大、車輪の再発明 |

### フレームワーク全体ではなくコンポーネントを選んだ理由

- 必要な機能だけを軽量に利用
- フレームワーク非依存で他プロジェクトへの組み込みが容易
- 依存関係の最小化

## 影響

### ポジティブ
- 開発速度の向上（CLI基盤を素早く構築）
- 堅牢なエラーハンドリングとユーザー体験
- テストの容易さ（入出力のモック化）

### ネガティブ
- 外部依存の追加（ただしComposerで標準的に管理可能）
- Symfonyのバージョンアップに追従が必要

## 参考

- [Symfony Console Documentation](https://symfony.com/doc/current/components/console.html)
- [Symfony Finder Documentation](https://symfony.com/doc/current/components/finder.html)
